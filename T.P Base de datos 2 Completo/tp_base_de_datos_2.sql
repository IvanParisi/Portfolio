-- MySQL Script generated by MySQL Workbench
-- Tue Jun  4 17:58:31 2019
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema db_empresa_colectivos
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `db_empresa_colectivos` ;

-- -----------------------------------------------------
-- Schema db_empresa_colectivos
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `db_empresa_colectivos` ;
USE `db_empresa_colectivos` ;

-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Proveedor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Proveedor` (
  `id_proveedor` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `mail` VARCHAR(45) NOT NULL,
  `cuit` VARCHAR(45) NOT NULL,
  `direccion` INT NOT NULL,
  `horario` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_proveedor`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Colectivo`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Colectivo` (
  `id_colectivo` INT NOT NULL AUTO_INCREMENT,
  `marca` VARCHAR(45) NOT NULL,
  `modelo` VARCHAR(45) NULL,
  `patente` VARCHAR(45) NOT NULL,
  `numero` VARCHAR(45) NOT NULL,
  `id_proveedor` INT NOT NULL,
  PRIMARY KEY (`id_colectivo`),
  INDEX `fk_Colectivo_Proveedor1_idx` (`id_proveedor` ASC) ,
  CONSTRAINT `fk_Colectivo_Proveedor1`
    FOREIGN KEY (`id_proveedor`)
    REFERENCES `db_empresa_colectivos`.`Proveedor` (`id_proveedor`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Chofer`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Chofer` (
  `id_chofer` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `dni` VARCHAR(9) NOT NULL,
  `telefono` VARCHAR(15) NOT NULL,
  `id_colectivo` INT NOT NULL,
  `direccion` VARCHAR(45) NOT NULL,
  `horario` VARCHAR(45) NULL,
  PRIMARY KEY (`id_chofer`),
  UNIQUE INDEX `id_chofer_UNIQUE` (`id_chofer` ASC) ,
  INDEX `fk_Chofer_Colectivo1_idx` (`id_colectivo` ASC) ,
  CONSTRAINT `fk_chofer_colectivo`
    FOREIGN KEY (`id_colectivo`)
    REFERENCES `db_empresa_colectivos`.`Colectivo` (`id_colectivo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Franco`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Franco` (
  `id_franco` INT NOT NULL AUTO_INCREMENT,
  `dia` DATE NOT NULL,
  `turno` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_franco`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Linea`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Linea` (
  `id_linea` INT NOT NULL AUTO_INCREMENT,
  `numero_linea` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_linea`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Ramal`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Ramal` (
  `id_ramal` INT NOT NULL AUTO_INCREMENT,
  `nombre_ramal` VARCHAR(45) NOT NULL,
  `id_recorrido` INT NOT NULL,
  `id_linea` INT NOT NULL,
  PRIMARY KEY (`id_ramal`),
  INDEX `fk_Ramal_Linea1_idx` (`id_linea` ASC) ,
  CONSTRAINT `fk_Ramal_Linea1`
    FOREIGN KEY (`id_linea`)
    REFERENCES `db_empresa_colectivos`.`Linea` (`id_linea`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Recorrido`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Recorrido` (
  `id_recorrido` INT NOT NULL,
  `barrio` VARCHAR(45) NOT NULL,
  `cantidad_paradas` VARCHAR(45) NULL,
  `imagen_de_recorrido` VARCHAR(45) NOT NULL,
  `id_ramal` INT NOT NULL,
  PRIMARY KEY (`id_recorrido`),
  INDEX `fk_recorrido_ramal_idx` (`id_ramal` ASC) ,
  CONSTRAINT `fk_recorrido_ramal`
    FOREIGN KEY (`id_ramal`)
    REFERENCES `db_empresa_colectivos`.`Ramal` (`id_ramal`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Parada`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Parada` (
  `id_parada` INT NOT NULL AUTO_INCREMENT,
  `calle` VARCHAR(45) NOT NULL,
  `numeracion` VARCHAR(45) NOT NULL,
  `Recorrido_id_recorrido` INT NOT NULL,
  PRIMARY KEY (`id_parada`),
  INDEX `fk_Parada_Recorrido1_idx` (`Recorrido_id_recorrido` ASC) ,
  CONSTRAINT `fk_Parada_Recorrido1`
    FOREIGN KEY (`Recorrido_id_recorrido`)
    REFERENCES `db_empresa_colectivos`.`Recorrido` (`id_recorrido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Mecanico`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Mecanico` (
  `id_mecanico` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NULL,
  `dni` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `direccion` VARCHAR(45) NOT NULL,
  `horario` VARCHAR(45) NULL,
  PRIMARY KEY (`id_mecanico`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Chofer_Franco`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Chofer_Franco` (
  `id_chofer_franco` INT NOT NULL AUTO_INCREMENT,
  `cantidad` VARCHAR(45) NOT NULL,
  `id_franco` INT NOT NULL,
  `id_chofer` INT NOT NULL,
  `Franco_id_franco` INT NOT NULL,
  `Chofer_id_chofer` INT NOT NULL,
  PRIMARY KEY (`id_chofer_franco`),
  INDEX `fk_Chofer_Franco_Franco1_idx` (`Franco_id_franco` ASC) ,
  INDEX `fk_Chofer_Franco_Chofer1_idx` (`Chofer_id_chofer` ASC) ,
  CONSTRAINT `fk_Chofer_Franco_Franco1`
    FOREIGN KEY (`Franco_id_franco`)
    REFERENCES `db_empresa_colectivos`.`Franco` (`id_franco`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Chofer_Franco_Chofer1`
    FOREIGN KEY (`Chofer_id_chofer`)
    REFERENCES `db_empresa_colectivos`.`Chofer` (`id_chofer`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Mecanico_Franco`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Mecanico_Franco` (
  `id_mecanico_franco` INT NOT NULL AUTO_INCREMENT,
  `cantidad` VARCHAR(45) NOT NULL,
  `id_franco` INT NOT NULL,
  `id_mecanico` INT NOT NULL,
  `Franco_id_franco` INT NOT NULL,
  `Mecanico_id_mecanico` INT NOT NULL,
  PRIMARY KEY (`id_mecanico_franco`),
  INDEX `fk_Mecanico_Franco_Franco1_idx` (`Franco_id_franco` ASC) ,
  INDEX `fk_Mecanico_Franco_Mecanico1_idx` (`Mecanico_id_mecanico` ASC) ,
  CONSTRAINT `fk_Mecanico_Franco_Franco1`
    FOREIGN KEY (`Franco_id_franco`)
    REFERENCES `db_empresa_colectivos`.`Franco` (`id_franco`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Mecanico_Franco_Mecanico1`
    FOREIGN KEY (`Mecanico_id_mecanico`)
    REFERENCES `db_empresa_colectivos`.`Mecanico` (`id_mecanico`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Reparacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Reparacion` (
  `id_reparacion` INT NOT NULL AUTO_INCREMENT,
  `tipo_reparacion` VARCHAR(45) NOT NULL,
  `estado` VARCHAR(45) NOT NULL,
  `id_mecanico` INT NOT NULL,
  `id_colectivo` INT NOT NULL,
  PRIMARY KEY (`id_reparacion`),
  INDEX `id_reparacion_mecanico_idx` (`id_mecanico` ASC) ,
  INDEX `id_reparacion_colectivo_idx` (`id_colectivo` ASC) ,
  CONSTRAINT `fk_reparacion_mecanico`
    FOREIGN KEY (`id_mecanico`)
    REFERENCES `db_empresa_colectivos`.`Mecanico` (`id_mecanico`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_reparacion_colectivo`
    FOREIGN KEY (`id_colectivo`)
    REFERENCES `db_empresa_colectivos`.`Colectivo` (`id_colectivo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_empresa_colectivos`.`Colectivo-Ramal`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_empresa_colectivos`.`Colectivo-Ramal` (
  `idColectivo-Ramal` INT NOT NULL AUTO_INCREMENT,
  `cantidad` VARCHAR(45) NOT NULL,
  `Colectivo_id_colectivo` INT NOT NULL,
  `Ramal_id_ramal` INT NOT NULL,
  PRIMARY KEY (`idColectivo-Ramal`),
  INDEX `fk_Colectivo-Ramal_Colectivo1_idx` (`Colectivo_id_colectivo` ASC) ,
  INDEX `fk_Colectivo-Ramal_Ramal1_idx` (`Ramal_id_ramal` ASC) ,
  CONSTRAINT `fk_Colectivo-Ramal_Colectivo1`
    FOREIGN KEY (`Colectivo_id_colectivo`)
    REFERENCES `db_empresa_colectivos`.`Colectivo` (`id_colectivo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Colectivo-Ramal_Ramal1`
    FOREIGN KEY (`Ramal_id_ramal`)
    REFERENCES `db_empresa_colectivos`.`Ramal` (`id_ramal`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

 -- INSERT TABLA franco 
INSERT INTO franco VALUES (1,20190609, "Mañana");
INSERT INTO franco VALUES (2,20190605,"Noche");
INSERT INTO franco VALUES (3,20190607, "Tarde");
INSERT INTO franco VALUES (4, 20190603, "Mañana");
INSERT INTO franco VALUES (5, 20190606, "Noche");


 -- INSERT TABLA LINEA
 INSERT INTO linea VALUES(1,"152");
 INSERT INTO linea VALUES(2,"41");
 INSERT INTO linea VALUES(3,"41");
 INSERT INTO linea VALUES(4,"68");
 INSERT INTO linea VALUES(5,"161");
 
-- INSERT TABLA PROVEEDOR 
INSERT INTO proveedor VALUES (1,"Metalpar","1548418900","info@metalpar.com.ar","30-60802710-2",9548,"12:00");
INSERT INTO proveedor VALUES (2,"Via Tac SA","08103337575","info@viatac.com.ar","33-64076481-9",1284,"13:00");
INSERT INTO proveedor VALUES (3,"Motores Argentinos","15264856662","info@motarg.com.ar","30-70965668-2",46,"14:00");
INSERT INTO proveedor VALUES (4,"Siselco S.R.L","44416890","info@siselco.com.ar","30-68593973-4""Constitución 3730",3730,"12:00");
INSERT INTO proveedor VALUES (5,"Carrocerías Galicia S.A.","42550312","info@carrosgalicia.com.ar","30-65587243-0",3012,"13:00");

-- INSERT TABLA COLECTIVO
INSERT INTO colectivo VALUES(1,"Mercedes Benz","OH-1621LE/59","AA008MS","34",1);
INSERT INTO colectivo VALUES(2,"Marcopolo","OH-1618LE/67","AB123CD","2",4);
INSERT INTO colectivo VALUES(3,"Mercedes Benz","OH-1621LE/59","FE399BB","10",3);
INSERT INTO colectivo VALUES(4,"Volvo","OH-165LE/60","BB889UO","22",2);
INSERT INTO colectivo VALUES(5,"Mercedes Benz","OH-1616LE/67","QP900EH","6",5);


-- INSERT TABLA MECANICO
INSERT INTO mecanico VALUES (1,"Willy","Pardi","28459666","1574334111","Santa Fe 1532","19 a 00");
INSERT INTO mecanico VALUES (2,"Orlando","Duran","32154688","1567422471","Moldes 3222","12 a 20");
INSERT INTO mecanico VALUES (3,"Luis","Diaz","35214012","1567576020","Montevideo 579","22 a 04");
INSERT INTO mecanico VALUES (4,"Federico","Puente","36454188","1571793214","Corrientes 3000","8 a 16");
INSERT INTO mecanico VALUES (5,"Arturo","Coca","24567811","1567472033","Freire 1490","14 a 22");


-- INSERT TABLA CHOFER
INSERT INTO chofer VALUES(1,"Ignacio","Blanco","30121314","1571450952",4,"Alvarez Thomas 235","20 a 1");
INSERT INTO chofer VALUES(2,"Claudio","Calisaya","30789542","1572786383",1,"Av. Belgrano 1200","5 a 12");
INSERT INTO chofer VALUES(3,"Nelson","Morales","29451068","1567569231",5,"Echeverria 255","13 a 18");
INSERT INTO chofer VALUES(4,"Javier","Mamani","34521687","1574807100",3,"Estado de Israel 100","20 a 1");
INSERT INTO chofer VALUES(5,"Jose","Vargas","28461300","1573890811",2,"Loria 874","19 a 00");

-- INSERT TABLA RAMAL
INSERT INTO ramal VALUES(1,"Olivos",1,1);
INSERT INTO ramal VALUES(2,"Por Viaducto",2,2);
INSERT INTO ramal VALUES(3,"Por Dorrego",3,3);
INSERT INTO ramal VALUES(4,"Por Carranza",4,4);
INSERT INTO ramal VALUES(5,"Por Martelli",5,5);


-- INSERT TABLA RECORRIDO
INSERT INTO recorrido VALUES (1,"La Boca - Vte López","52","img1.jpg",1);
INSERT INTO recorrido VALUES (2,"Carapachay - Villa Adelina","67","img2.jpg",2);
INSERT INTO recorrido VALUES (3,"Carapachay - Villa Adelina","43","img3.jpg",3);
INSERT INTO recorrido VALUES (4,"Plaza Miserere - Puente Saavedra","37","img4.jpg",4);
INSERT INTO recorrido VALUES (5,"Palermo -  Florida","94","img5.jpg",5);


-- INSERT TABLA REPARACION
INSERT INTO reparacion VALUES (1,"Reparación de asientos","En Proceso",5,2);
INSERT INTO reparacion VALUES (2,"Trompa y cola","En espera",1,4);
INSERT INTO reparacion VALUES (3,"Pintura general","Terminado",2,1);
INSERT INTO reparacion VALUES (4,"Cambio de motor","Falta repuesto",4,4);
INSERT INTO reparacion VALUES (5,"Cambio de rueda","Terminado",3,3);


-- INSERT TABLA PARADA
INSERT INTO parada VALUES(1,"Cabildo","1500",1);
INSERT INTO parada VALUES(2,"Pueyrredón","1000",2);
INSERT INTO parada VALUES(3,"Dorrego","800",3);
INSERT INTO parada VALUES(4,"Santa Fé","1400",4);
INSERT INTO parada VALUES(5,"Av. Díaz Vélez","3000",5);

SELECT * FROM reparacion WHERE estado = "TERMINADO";
SELECT nombre,numero from chofer INNER JOIN colectivo on (chofer.id_colectivo = colectivo.id_colectivo);
SELECT * FROM mecanico a INNER JOIN reparacion b ON (a.id_mecanico = b.id_mecanico) INNER JOIN colectivo c ON (b.id_colectivo = c.id_colectivo);
SELECT * FROM chofer WHERE nombre like '%O';
SELECT nombre,apellido,dni FROM chofer UNION SELECT nombre,apellido,dni FROM mecanico;
SELECT dia,turno FROM franco group by (turno) HAVING (count(turno) > 1);
SELECT * FROM mecanico WHERE dni > (SELECT avg(dni) FROM chofer);
begin;
UPDATE colectivo SET marca = 'Ferrari' WHERE marca = 'Volvo';
commit;
begin;
DELETE FROM reparacion WHERE id_colectivo = 2;
rollback;

CREATE INDEX idx_chofer_apellido ON chofer(apellido);

DROP TABLE IF EXISTS reparaciones_completas;
CREATE TEMPORARY TABLE reparaciones_completas( 
SELECT a.nombre,a.apellido,b.estado,b.tipo_reparacion,c.numero,c.patente FROM mecanico a 
INNER JOIN reparacion b ON (a.id_mecanico = b.id_mecanico) 
INNER JOIN colectivo c ON (b.id_colectivo = c.id_colectivo));
SELECT * FROM reparaciones_completas;

